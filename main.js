(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{JK:()=>B,H6:()=>z,IV:()=>M});const t="menu",i="single",s="placeShips",r="playGame";class a{constructor(){this.currentState=t}changeState(e){this.hideCurrentState(),this.currentState=e,this.onStateChange(e)}onStateChange(e){switch(e){case t:this.displayMenu();break;case i:this.displayMenuSingle();break;case s:this.displayPlaceShips();break;case r:this.displayPlayGame();break;default:console.error("Invalid state:",e)}}hideCurrentState(){switch(this.currentState){case t:this.hideMenu();break;case i:this.hideMenuSingle();break;case s:this.hidePlaceShips()}}displayMenu(){document.querySelector(".play-options").style.display="grid"}hideMenu(){document.querySelector(".play-options").style.display="none"}displayMenuSingle(){document.querySelector(".single-player").style.display="grid",z.primaryPlayer._board.displayBoard("place ships")}hideMenuSingle(){document.querySelector(".container-menu").style.display="none"}hideMenuContainer(){document.querySelector(".container-menu").style.display="none"}displayPlaceShips(){document.querySelector(".container-place-ships").style.display="grid"}hidePlaceShips(){document.querySelector(".container-place-ships").style.display="none"}displayPlayGame(){document.querySelector(".container-play-game").style.display="grid",z.secondaryPlayer.placeShipsOnBoard(),z.primaryPlayer._board.displayBoard("play game your grid"),z.secondaryPlayer._board.displayBoard("play game enemy grid")}hidePlayGame(){document.querySelector(".container-play-game").style.display="none"}}let n=!0;function l(e){n=e}function o(){return n}const h=document.querySelector(".current-ship-4"),c=document.querySelector(".current-ship-3"),d=document.querySelector(".current-ship-2"),u=document.querySelector(".current-ship-1"),p=document.querySelector(".size-4.one");let y=[p,document.querySelector(".size-3.one"),document.querySelector(".size-3.two"),document.querySelector(".size-2.one"),document.querySelector(".size-2.two"),document.querySelector(".size-2.three"),document.querySelector(".size-1.one"),document.querySelector(".size-1.two"),document.querySelector(".size-1.three"),document.querySelector(".size-1.four")],m=p,S=h;function g(){S.style.display="none"}function f(e){e.style.display="grid"}function G(e){e.classList.add("active"),m=e}function q(e){switch(e.classList[1]){case"size-4":return S=h,document.querySelector(".current-ship-4");case"size-3":return S=c,document.querySelector(".current-ship-3");case"size-2":return S=d,document.querySelector(".current-ship-2");case"size-1":return S=u,document.querySelector(".current-ship-1")}}function P(){const e=(e=>{const t=/\d+/;for(let i=0;i<e.classList.length;i++)if(t.test(e.classList[i]))return e.classList[i];return null})(m);if(!e)return null;const t=e.match(/\d+/);return t?parseInt(t[0],10):null}function _(){m.classList.remove("active")}function C(){return!(y.length>0)}function b(e,t,i){if(i){if(e-10*(t-1)<0)return!1}else{const i=e-(t-1);if(i<0||i%10>e%10)return!1}return!0}function E(e){let t=!0;return e.forEach((e=>{e.isSunk||(t=!1)})),t}class v{constructor(){this._hasShip=!1,this._ship=null,this._isShot=!1,this._isAdjacent=!1}set hasShip(e){this._hasShip=e}get hasShip(){return this._hasShip}set ship(e){this._ship=e}get ship(){return this._ship}set isShot(e){this._isShot=e}get isShot(){return this._isShot}set isAdjacent(e){this._isAdjacent=e}get isAdjacent(){return this._isAdjacent}}class L{constructor(e,t,i,s){this.id=e,this._length=t,this._timesHit=i,this._isSunk=s}get length(){return this._length}incrementTimesHit(){this._timesHit++}get timesHit(){return this._timesHit}get isSunk(){return this._timesHit>=this._length}set isSunk(e){this._isSunk=e}}class H{constructor(){this._board=this.initEmptyBoard(),this._ships=this.initShips()}get ships(){return this._ships}displayBoard(e){"place ships"===e?M.displayPlaceShipsGrid(this._board):"play game your grid"===e?M.displayPlayGameYourGrid(this._board):"play game enemy grid"===e&&M.displayPlayGameEnemyGrid(this._board)}initEmptyBoard(){let e=[];for(let t=0;t<10;t++){e[t]=[];for(let i=0;i<10;i++)e[t][i]=new v}return e}initShips(){let e=[];return e.push(new L("4a",4,0,!1)),e.push(new L("3a",3,0,!1)),e.push(new L("3b",3,0,!1)),e.push(new L("2a",2,0,!1)),e.push(new L("2b",2,0,!1)),e.push(new L("2c",2,0,!1)),e.push(new L("1a",1,0,!1)),e.push(new L("1b",1,0,!1)),e.push(new L("1c",1,0,!1)),e.push(new L("1d",1,0,!1)),e}placeShip(e,t,i,s){if(!(t?this.isValidVertical(e,i):this.isValidHorizontal(e,i)))return!1;const r=this.getOccupiedSquares(e,t,i),a=this.getSurroundingCoords(r);return this.setHasShipSquares(r),this.setShipSquares(r,s),this.setAdjacentSquares(a),!0}setShipSquares(e,t){e.forEach((e=>{let i=e[0],s=e[1];this._board[i][s].ship=t}))}setHasShipSquares(e){e.forEach((e=>{let t=e[0],i=e[1];this._board[t][i].hasShip=!0}))}setAdjacentSquares(e){e.forEach((e=>{let t=e[0],i=e[1];this._board[t][i].isAdjacent=!0}))}getOccupiedSquares(e,t,i){let s=[],r=e[0],a=e[1];if(t)for(let e=0;e<i;e++)s[e]=[r,a-e];else for(let e=0;e<i;e++)s[e]=[r-e,a];return s}isValidVertical(e,t){let i=e[0],s=e[1];if(s-(t-1)<0)return!1;let r=[];for(let e=0;e<t;e++)r[e]=[i,s-e];let a=!0;return r.forEach((e=>{let t=e[0],i=e[1];(this._board[t][i].hasShip||this._board[t][i].isAdjacent)&&(a=!1)})),a}isValidHorizontal(e,t){let i=e[0],s=e[1];if(i-(t-1)<0)return!1;let r=[];for(let e=0;e<t;e++)r[e]=[i-e,s];let a=!0;return r.forEach((e=>{let t=e[0],i=e[1];(this._board[t][i].hasShip||this._board[t][i].isAdjacent)&&(a=!1)})),a}getSurroundingCoords(e){let t=[];for(let i=0;i<e.length;i++){let s=e[i][0],r=e[i][1];t.push([s-1,r-1]),t.push([s,r-1]),t.push([s+1,r-1]),t.push([s-1,r]),t.push([s,r]),t.push([s+1,r]),t.push([s-1,r+1]),t.push([s,r+1]),t.push([s+1,r+1])}const i=t.filter(((e,t,i)=>t===i.findIndex((t=>JSON.stringify(t)===JSON.stringify(e))))).filter((e=>e[0]>=0&&e[0]<10&&e[1]>=0&&e[1]<10)),s=e.map((e=>e.toString()));return i.filter((e=>!s.includes(e.toString())))}recieveShot(e){let t;const i=e[0],s=e[1],r=this._board[i][s];if(r.isShot)t=0;else if(r.isShot=!0,r.hasShip){const e=r.ship;t=e,e.incrementTimesHit(),e.isSunk&&(e.isSunk=!0)}else t=1;return t}}class w{constructor(e,t,i){this._name=e,this._board=t,this._opponentBoard=i}set name(e){this._name=e}get name(){return this._name}get board(){return this._board}get opponentBoard(){return this._opponentBoard}}class k extends w{constructor(e,t){super("Harold",e,t)}setName(e){super.name=e}getName(){return super.name}getBoard(){return super.board}getOpponentBoard(){return super.opponentBoard}placeShipsOnBoard(){const e=super.board;let t=[...e.ships];for(;t.length>0;){const i=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),r=Math.random()<.5,a=Math.floor(Math.random()*t.length),n=t[a];e.placeShip([i,s],r,n.length,n)&&t.splice(a,1)}}takeTurn(){let e=!1;for(console.log(z.primaryPlayer._board.ships);!e;){const t=super.opponentBoard._board,i=Math.floor(10*Math.random()),s=Math.floor(10*Math.random());if(!t[i][s].isShot){if(t[i][s].isShot=!0,t[i][s].hasShip){const e=t[i][s].ship;e.incrementTimesHit(),console.log(e),e.isSunk&&(console.log("sunk:"),console.log(e),e.isSunk=!0,E(z.primaryPlayer._board.ships)&&alert("You lose!"))}e=!0}}z.turn=0}}const B=new class{constructor(){this.stateManager=new a,this.sourceCodeButton=document.querySelector(".source-code"),this.singlePlayerButton=document.querySelector(".single-player-button"),this.playGameButton=document.querySelector(".play-game-button"),this.primaryPlayerNameInput=document.querySelector("#primary-player-name"),this.primaryPlayerNameInputError=document.querySelector(".primary-player-error"),this.placeShipsGridContainer=document.querySelector(".your-grid"),this.confirmShipPlacementButton=document.querySelector(".confirm-button"),this.lastHighlighted=[]}initToggleOrientation(){document.addEventListener("keydown",(e=>{"r"===e.key&&(o()?(l(!1),this.updateHighlightedCells(this.lastHighlighted[0],!0)):(l(!0),this.updateHighlightedCells(this.lastHighlighted[0],!0)))}))}initConfirmShipPlacementButton(){this.confirmShipPlacementButton.addEventListener("click",(()=>{this.stateManager.changeState(r)}))}updateHighlightedCells(e,t){if(e==this.lastHighlighted[0]&&!t)return;if(e.classList.contains("has-ship")||e.classList.contains("is-adjacent"))return;const i=P(),s=e.dataset.index;if(this.clearLastHighlighted(),o()&&b(s,i,!0))for(let e=0;e<i;e++){const t=s-10*e;if(t>=0){const e=this.placeShipsGridContainer.children[t];this.lastHighlighted.push(e),e.id="highlight"}else this.clearLastHighlighted()}else if(!o()){if(!b(s,i,!1))return void this.clearLastHighlighted();for(let e=0;e<i;e++){const t=s-1*e,i=this.placeShipsGridContainer.children[t];this.lastHighlighted.push(i),i.id="highlight"}}}handleCellMouseOver(e){e.addEventListener("mouseover",(e=>this.updateHighlightedCells(e.target)))}handleClick(e){e.addEventListener("click",(()=>this.placeShip(e)))}getSelectedShipId(e){let t;return e.classList.contains("size-4")?t="4a":e.classList.contains("size-3")?e.classList.contains("one")?t="3a":e.classList.contains("two")&&(t="3b"):e.classList.contains("size-2")?e.classList.contains("one")?t="2a":e.classList.contains("two")?t="2b":e.classList.contains("three")&&(t="2c"):e.classList.contains("size-1")&&(e.classList.contains("one")?t="1a":e.classList.contains("two")?t="1b":e.classList.contains("three")?t="1c":e.classList.contains("four")&&(t="1d")),t}placeShip(e){if(C())return;const t=o(),i=P(),s=function(e){return[e%10,Math.floor(e/10)]}(e.dataset.index),r=this.getSelectedShipId(m),a=function(e,t){for(let i=0;i<e.length;i++)if(e[i].id===t)return i;return-1}(z.primaryPlayer._board._ships,r),n=z.primaryPlayer._board.ships[a];z._primaryPlayer._board.placeShip(s,t,i,n)&&(console.log(z.primaryPlayer._board),function(){_(),m.querySelectorAll("div").forEach((e=>{e.id="placed"}));for(let e=0;e<y.length;e++)y[e]===m&&y.splice(e,1);y.length>0&&(G(y[0]),g(),f(q(y[0])))}()),z._primaryPlayer._board.displayBoard("place ships"),C()&&(document.querySelector(".confirm-button").disabled=!1)}initPlaceShipEventListener(){this.placeShipsGridContainer.querySelectorAll("div").forEach((e=>{this.handleCellMouseOver(e),this.handleClick(e)}))}clearLastHighlighted(){for(;this.lastHighlighted.length>0;)this.lastHighlighted[0].id="",this.lastHighlighted.shift()}initSinglePlayerButton(){this.singlePlayerButton.addEventListener("click",(()=>{this.stateManager.changeState(i)}))}initPlayGameButton(){this.playGameButton.addEventListener("click",(()=>{this.primaryPlayerNameInput.value?(this.primaryPlayerNameInputError.style.display="none",this.stateManager.changeState(s)):this.primaryPlayerNameInputError.style.display="block"}))}initSourceCodeButton(){this.sourceCodeButton.addEventListener("click",(()=>{}))}},M=new class{constructor(){this.placeShipsGridContainer=document.querySelector(".your-grid"),this.playGameYourGrid=document.querySelector(".play-game-your-board"),this.playGameEnemyGrid=document.querySelector(".play-game-enemy-board"),this.lastHovered=null}displayPlayGameYourGrid(e){this.clearPlayGameYourGrid(),this.createYourGridSquaresPlayGame(),this.setSquareClassesYourGridPlayGame(e)}displayPlayGameEnemyGrid(e){this.clearPlayGameEnemyGrid(),this.createEnemyGridSquaresPlayGame(),this.setSquareClassesEnemyGridPlayGame(e)}setSquareClassesEnemyGridPlayGame(e){let t=[];for(let i=0;i<e[0].length;i++)for(let s=0;s<e.length;s++)t.push(e[s][i]);for(let e=0;e<t.length;e++){const i=this.playGameEnemyGrid.querySelector(":nth-child("+(e+1)+")");t[e].isShot&&t[e].hasShip&&(this.setSquareCSSClass(i,"direct-hit"),this.addHitImgToSquare(i)),t[e].isShot&&!t[e].hasShip&&(this.setSquareCSSClass(i,"miss"),this.addMissImgToSquare(i))}}clearPlayGameYourGrid(){const e=this.playGameYourGrid;if(!(e.children.length<=0))for(;this.playGameYourGrid.firstChild;)e.removeChild(e.firstChild)}clearPlayGameEnemyGrid(){const e=this.playGameEnemyGrid;if(!(e.children.length<=0))for(;this.playGameEnemyGrid.firstChild;)e.removeChild(e.firstChild)}createYourGridSquaresPlayGame(){for(let e=0;e<100;e++){const t=document.createElement("div");t.classList.add("play-game-your-board-default-square"),t.dataset.index=e,t.style.display="grid",t.style.placeItems="center",this.playGameYourGrid.appendChild(t)}}createEnemyGridSquaresPlayGame(){for(let e=0;e<100;e++){const t=document.createElement("div");t.classList.add("play-game-enemy-board-default-square"),t.dataset.index=e,t.style.display="grid",t.style.placeItems="center",t.addEventListener("mouseover",(e=>this.handleEnemyGridHover(e))),t.addEventListener("click",(e=>this.handleEnemyGridClick(e))),this.playGameEnemyGrid.appendChild(t)}}handleEnemyGridClick(e){if(1===z.turn)return;const t=e.target.dataset.index,i=z.secondaryPlayer._board,s=function(e,t){return[e%10,Math.floor(e/10)]}(t),r=i.recieveShot(s);r&&(this.displayPlayGameEnemyGrid(i._board),"number"!=typeof r&&r.isSunk&&E(z.secondaryPlayer._board.ships)&&alert("Game over, you win!")),z.turn=1,z.secondaryPlayer.takeTurn(),z.primaryPlayer._board.displayBoard("play game your grid")}handleEnemyGridHover(e){const t=e.target;t.classList.contains("play-game-enemy-board-default-square")?(this.lastHovered&&this.lastHovered.classList.remove("hovering"),this.lastHovered=t,t.classList.add("hovering")):(this.lastHovered&&this.lastHovered.classList.remove("hovering"),this.lastHovered=null)}setSquareClassesYourGridPlayGame(e){let t=[];for(let i=0;i<e[0].length;i++)for(let s=0;s<e.length;s++)t.push(e[s][i]);for(let e=0;e<t.length;e++){const i=this.playGameYourGrid.querySelector(":nth-child("+(e+1)+")");t[e].hasShip&&this.setSquareCSSClass(i,"occupied"),t[e].isShot&&t[e].hasShip&&(this.setSquareCSSClass(i,"direct-hit"),this.addHitImgToSquare(i)),t[e].isShot&&!t[e].hasShip&&(this.setSquareCSSClass(i,"miss"),this.addMissImgToSquare(i))}}addHitImgToSquare(e){const t=document.createElement("img");t.src="./img/cross.svg",t.width="40",t.alt="White cross, indicating a direct hit",e.appendChild(t)}addMissImgToSquare(e){const t=document.createElement("img");t.src="./img/miss.svg",t.width="20",t.alt="Grey circle, indicating a missed shot",e.appendChild(t)}displayPlaceShipsGrid(e){this.clearPlaceShipsGrid(),this.createGridSquares(),this.addPlaceShipsEventListeners(),this.setSquareClasses(e)}addPlaceShipsEventListeners(){B.initPlaceShipEventListener(z.primaryPlayer._board,B.getSelectedShipId(m))}setSquareClasses(e){let t=[];for(let i=0;i<e[0].length;i++)for(let s=0;s<e.length;s++)t.push(e[s][i]);for(let e=0;e<t.length;e++){const i=this.placeShipsGridContainer.querySelector(":nth-child("+(e+1)+")");t[e].isAdjacent&&this.setSquareCSSClass(i,"is-adjacent"),t[e].hasShip&&this.setSquareCSSClass(i,"has-ship")}}setSquareCSSClass(e,t){for(;e.classList.length>0;)e.classList.remove(e.classList[0]);e.classList.add(t)}createGridSquares(){for(let e=0;e<100;e++){const t=document.createElement("div");t.classList.add("default-square"),t.dataset.index=e,this.placeShipsGridContainer.appendChild(t)}}clearPlaceShipsGrid(){const e=this.placeShipsGridContainer;if(!(e.children.length<=0))for(;this.placeShipsGridContainer.firstChild;)e.removeChild(e.firstChild)}},z=new class{constructor(e,t){let i=new H,s=new H;this._primaryPlayer=new w(e,i,s),this._secondaryPlayer=t?new w(t,s,i):new k(s,i),this._turn=0}get primaryPlayer(){return this._primaryPlayer}get secondaryPlayer(){return this._secondaryPlayer}set turn(e){this._turn=e}get turn(){return this._turn}}("Kyle");let I=z.primaryPlayer;B.stateManager.changeState(t),B.initPlayGameButton(),B.initSinglePlayerButton(),B.initConfirmShipPlacementButton(),B.initToggleOrientation(),document.querySelectorAll(".ship").forEach((e=>{e.addEventListener("click",(e=>function(e){if(!function(e){let t=!1;return y.forEach((i=>{e===i&&(t=!0)})),t}(e.target.parentElement))return;_(),G(e.target.parentElement),g();f(q(e.target.parentElement))}(e)))})),B.initPlaceShipEventListener(I._board,"4a")})();